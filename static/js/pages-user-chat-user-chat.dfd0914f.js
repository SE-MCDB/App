(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-user-chat-user-chat"],{"0633":function(e,t,r){var n=r("7e21");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var i=r("4f06").default;i("66f10f3e",n,!0,{sourceMap:!1,shadowMode:!1})},"1b6c":function(e,t,r){"use strict";r.r(t);var n=r("3ba4"),i=r("ae68");for(var a in i)"default"!==a&&function(e){r.d(t,e,(function(){return i[e]}))}(a);r("c671");var o,s=r("f0c5"),u=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"58b6c734",null,!1,n["a"],o);t["default"]=u.exports},"20ce":function(e,t,r){"use strict";var n=r("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.createContact=t.getNeedDetail=void 0,r("96cf");var i=n(r("1da1")),a=n(r("4622")),o=(n(r("46ee")),r("13b4"),function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("id is"+t),console.log("getNeedDetail"),r={Authorization:"Bearer "+uni.getStorageSync("token")},e.next=5,a.default.get("need/"+t,{},r);case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());t.getNeedDetail=o;var s=function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={Authorization:"Bearer "+uni.getStorageSync("token")},e.next=3,a.default.post("need/contact",t,r);case 3:return n=e.sent,console.log(n.error_msg),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.createContact=s},"236a":function(e,t,r){"use strict";r.r(t);var n=r("fb60"),i=r("ace0");for(var a in i)"default"!==a&&function(e){r.d(t,e,(function(){return i[e]}))}(a);var o,s=r("f0c5"),u=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"6bbee38c",null,!1,n["a"],o);t["default"]=u.exports},2400:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={name:"tuiBubblePopup",props:{width:{type:String,default:"300rpx"},radius:{type:String,default:"8rpx"},left:{type:String,default:"auto"},right:{type:String,default:"auto"},top:{type:String,default:"auto"},bottom:{type:String,default:"auto"},translateX:{type:String,default:"0"},translateY:{type:String,default:"0"},backgroundColor:{type:String,default:"#4c4c4c"},color:{type:String,default:"#fff"},borderWidth:{type:String,default:"12rpx"},direction:{type:String,default:"top"},triangleLeft:{type:String,default:"auto"},triangleRight:{type:String,default:"auto"},triangleTop:{type:String,default:"auto"},triangleBottom:{type:String,default:"auto"},position:{type:String,default:"fixed"},flexEnd:{type:Boolean,default:!1},mask:{type:Boolean,default:!0},maskBgColor:{type:String,default:"rgba(0, 0, 0, 0.4)"},show:{type:Boolean,default:!1}},methods:{handleClose:function(){this.show&&this.$emit("close",{})},stop:function(){return!1}}};t.default=n},2908:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={data:function(){return{text:""}},methods:{submit:function(){this.$emit("submit",this.text),this.text=""}}};t.default=n},"311d":function(e,t,r){"use strict";r.r(t);var n=r("4cef"),i=r.n(n);for(var a in n)"default"!==a&&function(e){r.d(t,e,(function(){return n[e]}))}(a);t["default"]=i.a},"3ba4":function(e,t,r){"use strict";var n;r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return n}));var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-uni-view",{class:{"tui-flex-end":e.flexEnd}},[r("v-uni-view",{staticClass:"tui-popup-list",class:{"tui-popup-show":e.show,"tui-z_index":e.show&&"relative"!=e.position},style:{width:e.width,backgroundColor:e.backgroundColor,borderRadius:e.radius,color:e.color,position:e.position,left:e.left,right:e.right,bottom:e.bottom,top:e.top,transform:"translate("+e.translateX+","+e.translateY+")"}},["top"==e.direction?r("v-uni-view",{staticClass:"tui-triangle",style:{borderWidth:e.borderWidth,borderColor:"transparent transparent "+e.backgroundColor+" transparent",left:e.triangleLeft,right:e.triangleRight,top:e.triangleTop,bottom:e.triangleBottom}}):e._e(),"bottom"==e.direction?r("v-uni-view",{staticClass:"tui-triangle",style:{borderWidth:e.borderWidth,borderColor:e.backgroundColor+"  transparent transparent transparent",left:e.triangleLeft,right:e.triangleRight,top:e.triangleTop,bottom:e.triangleBottom}}):e._e(),"left"==e.direction?r("v-uni-view",{staticClass:"tui-triangle",style:{borderWidth:e.borderWidth,borderColor:"transparent  "+e.backgroundColor+" transparent transparent",left:e.triangleLeft,right:e.triangleRight,top:e.triangleTop,bottom:e.triangleBottom}}):e._e(),"right"==e.direction?r("v-uni-view",{staticClass:"tui-triangle",style:{borderWidth:e.borderWidth,borderColor:"transparent transparent  transparent "+e.backgroundColor,left:e.triangleLeft,right:e.triangleRight,top:e.triangleTop,bottom:e.triangleBottom}}):e._e(),e._t("default")],2),e.mask?r("v-uni-view",{staticClass:"tui-popup-mask",class:{"tui-popup-show":e.show},style:{backgroundColor:e.maskBgColor},on:{touchmove:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=e.$handleEvent(t),e.stop.apply(void 0,arguments)},click:function(t){arguments[0]=t=e.$handleEvent(t),e.handleClose.apply(void 0,arguments)}}}):e._e()],1)},a=[]},"4cef":function(e,t,r){"use strict";r("a9e3"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={props:{item:Object,index:Number},methods:{navUserInfo:function(){this.$emit("goToUserInfo",this.item)}}};t.default=n},"55fc":function(e,t,r){"use strict";r.r(t);var n=r("bc33"),i=r("311d");for(var a in i)"default"!==a&&function(e){r.d(t,e,(function(){return i[e]}))}(a);r("8385");var o,s=r("f0c5"),u=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"1e3552f9",null,!1,n["a"],o);t["default"]=u.exports},"5b36":function(e,t,r){"use strict";var n;r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return n}));var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-uni-view",{staticClass:"user-chat-bottom u-f-ac animated fadeInDown fast"},[r("v-uni-input",{attrs:{type:"text",placeholder:"请输入私信","confirm-type":"search"},on:{confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.submit.apply(void 0,arguments)}},model:{value:e.text,callback:function(t){e.text=t},expression:"text"}}),r("v-uni-view",{staticClass:"icon iconfont icon-fabu u-f-ajc",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.submit.apply(void 0,arguments)}}})],1)},a=[]},"7d2f":function(e,t,r){"use strict";var n=r("4ea4");r("a4d3"),r("e01a"),r("d81d"),Object.defineProperty(t,"__esModule",{value:!0}),t.accomplishOrder=t.rejectOrder=t.acceptOrder=t.getAllOrder=t.getPendingOrder=t.getCooperatingOrder=t.getFinishedOrder=void 0,r("96cf");var i=n(r("1da1")),a=n(r("4622")),o=r("13b4");function s(e){var t={order_id:e.order_id,entp_id:e.need.enterprise_id,entp_name:e.need.enterprise_name,description:e.need.enterprise_description,headpic:o.picUrl+e.need.enterprise_pic,exp_id:e.expert_id,title:e.need.title,time:e.end_time,need_id:e.need.need_id};return"undefined"!=t.description&&null!=t.description&&""!=t.description||(t.description="Lux et veritas"),"undefined"!=t.time&&null!=t.time&&""!=t.time||(t.time="今天"),t}var u=function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("getFinishedOrder"),e.next=3,a.default.get("user/"+t+"/order/finished");case 3:return r=e.sent,r=r.data,r&&r.length&&(r=r.map((function(e){return s(e)}))),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.getFinishedOrder=u;var d=function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("getCooperatingOrder"),e.next=3,a.default.get("user/"+t+"/order/cooperating");case 3:return r=e.sent,r=r.data,r&&r.length&&(r=r.map((function(e){return s(e)}))),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.getCooperatingOrder=d;var c=function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("getPendingOrder"),e.next=3,a.default.get("user/"+t+"/order/pending");case 3:return r=e.sent,r=r.data,r&&r.length&&(r=r.map((function(e){return s(e)}))),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.getPendingOrder=c;var l=function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("getAllOrder"),e.next=3,a.default.get("user/"+t+"/order/all");case 3:return r=e.sent,console.log(r),r=r.data,r&&r.length&&(r=r.map((function(e){return s(e)}))),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.getAllOrder=l;var f=function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("getacceptOrder"),n={Authorization:"Bearer "+uni.getStorageSync("token")},e.next=4,a.default.post("user/"+t+"/order/"+r+"/accept",{},n);case 4:return i=e.sent,e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();t.acceptOrder=f;var p=function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("getrejectOrder"),n={Authorization:"Bearer "+uni.getStorageSync("token")},e.next=4,a.default.post("user/"+t+"/order/"+r+"/refuse",{},n);case 4:return i=e.sent,e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();t.rejectOrder=p;var h=function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("getaccomplishOrder"),n={Authorization:"Bearer "+uni.getStorageSync("token")},e.next=4,a.default.post("user/"+t+"/order/"+r+"/finish",{},n);case 4:return i=e.sent,console.log(i.error_msg),e.abrupt("return",i);case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();t.accomplishOrder=h},"7e21":function(e,t,r){var n=r("24fb");t=n(!1),t.push([e.i,".tui-popup-list[data-v-58b6c734]{z-index:1;transition:all .3s ease-in-out;opacity:0;visibility:hidden}.tui-flex-end[data-v-58b6c734]{width:100%;display:flex;justify-content:flex-end}.tui-triangle[data-v-58b6c734]{position:absolute;width:0;height:0;border-style:solid;z-index:997}.tui-popup-mask[data-v-58b6c734]{position:fixed;top:0;left:0;right:0;bottom:0;z-index:995;transition:all .3s ease-in-out;opacity:0;visibility:hidden}.tui-popup-show[data-v-58b6c734]{opacity:1;visibility:visible}.tui-z_index[data-v-58b6c734]{z-index:996}",""]),e.exports=t},8385:function(e,t,r){"use strict";var n=r("921c"),i=r.n(n);i.a},"921c":function(e,t,r){var n=r("e6bc");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var i=r("4f06").default;i("357db47e",n,!0,{sourceMap:!1,shadowMode:!1})},a34d:function(e,t,r){"use strict";var n=r("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.getChat=t.createChat=t.pushMessage=t.createOrder=t.getOrder=t.getContact=void 0,r("96cf");var i=n(r("1da1")),a=n(r("4622")),o=n(r("46ee")),s=r("13b4"),u=function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={Authorization:"Bearer "+uni.getStorageSync("token")},e.next=3,a.default.get("need/get_contact",t,r);case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.getContact=u;var d=function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={Authorization:"Bearer "+uni.getStorageSync("token")},e.next=3,a.default.get("order/get",t,r);case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.getOrder=d;var c=function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={Authorization:"Bearer "+uni.getStorageSync("token")},console.log(t),e.next=4,a.default.post("order",t,r);case 4:return n=e.sent,console.log("createOrder "+n.error_msg),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.createOrder=c;var l=function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={Authorization:"Bearer "+uni.getStorageSync("token")},a.default.setLoading(!1),e.next=4,a.default.post("chat/push",t,r);case 4:return n=e.sent,a.default.setLoading(!0),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.pushMessage=l;var f=function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={Authorization:"Bearer "+uni.getStorageSync("token")},e.next=3,a.default.post("chat/create",t,r);case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.createChat=f;var p=function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(t,r){var n,i,u,d,c,l,f;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={Authorization:"Bearer "+uni.getStorageSync("token")},e.next=3,a.default.get("chat/"+t,{},n);case 3:return i=e.sent,u={},i&&(d=r.id==i.from_user_id?i.to_user_id:i.from_user_id,c=o.default.gettime.gettime(new Date),l="",f=i.message_list,u={id:i.chatroom_id,fid:d,fromId:i.from_user_id,toId:i.to_user_id,afterTime:+new Date(i.afterTime),userpic:i.from_user_id==r.id?s.picUrl+i.to_user_pic:s.picUrl+i.from_user_pic,username:i.from_user_id==r.id?i.to_user_name:i.from_user_name,time:c,message:l,noreadnum:0,messages:f}),e.abrupt("return",u);case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();t.getChat=p},ace0:function(e,t,r){"use strict";r.r(t);var n=r("e3be"),i=r.n(n);for(var a in n)"default"!==a&&function(e){r.d(t,e,(function(){return n[e]}))}(a);t["default"]=i.a},ae68:function(e,t,r){"use strict";r.r(t);var n=r("2400"),i=r.n(n);for(var a in n)"default"!==a&&function(e){r.d(t,e,(function(){return n[e]}))}(a);t["default"]=i.a},bc33:function(e,t,r){"use strict";var n;r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return n}));var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-uni-view",{staticClass:"user-chat-item animated fadeIn fast"},[e.item.gstime?r("v-uni-view",{staticClass:"user-chat-time u-f-ajc"},[e._v(e._s(e.item.gstime))]):e._e(),r("v-uni-view",{staticClass:"user-chat-list u-f",class:{"user-chat-me":e.item.isme}},[e.item.isme?e._e():r("v-uni-image",{attrs:{src:e.item.userpic,mode:"widthFix","lazy-load":!0},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.navUserInfo.apply(void 0,arguments)}}}),r("v-uni-view",{staticClass:"user-chat-list-body"},["text"==e.item.type?r("v-uni-text",[e._v(e._s(e.item.message))]):e._e(),"img"==e.item.type?r("v-uni-image",{attrs:{src:e.item.message,mode:"widthFix","lazy-load":!0}}):e._e()],1),e.item.isme?r("v-uni-image",{attrs:{src:e.item.userpic,mode:"widthFix","lazy-load":!0}}):e._e()],1)],1)},a=[]},c671:function(e,t,r){"use strict";var n=r("0633"),i=r.n(n);i.a},c881:function(e,t,r){"use strict";var n=r("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.needToOrderlist=t.getOrderDetail=void 0,r("96cf");var i=n(r("1da1")),a=n(r("4622")),o=(n(r("46ee")),r("13b4"),function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("getOrderDetail"),r={Authorization:"Bearer "+uni.getStorageSync("token")},e.next=4,a.default.get("order/"+t,{},r);case 4:return n=e.sent,console.log(n.error_msg),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());t.getOrderDetail=o;var s=function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("needToOrderlist"),r={Authorization:"Bearer "+uni.getStorageSync("token")},e.next=4,a.default.get("need/"+t+"/order",{},r);case 4:return n=e.sent,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.needToOrderlist=s},cca1:function(e,t,r){var n=r("24fb");t=n(!1),t.push([e.i,".user-chat-bottom[data-v-69ea4013]{position:fixed;bottom:0;left:0;right:0;height:%?120?%;padding:0 %?20?%;background:#fff;border-top:%?1?% solid #eee}.user-chat-bottom>uni-input[data-v-69ea4013]{flex:1;margin-right:%?20?%;padding:%?10?% %?20?%;border-radius:%?10?%;background:#f7f7f7}.user-chat-bottom>uni-view[data-v-69ea4013]{width:%?80?%;font-size:%?45?%}",""]),e.exports=t},cced:function(e,t,r){"use strict";r.r(t);var n=r("5b36"),i=r("d5b5");for(var a in i)"default"!==a&&function(e){r.d(t,e,(function(){return i[e]}))}(a);r("e0cb");var o,s=r("f0c5"),u=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"69ea4013",null,!1,n["a"],o);t["default"]=u.exports},d403:function(e,t,r){var n=r("cca1");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var i=r("4f06").default;i("44ab10be",n,!0,{sourceMap:!1,shadowMode:!1})},d5b5:function(e,t,r){"use strict";r.r(t);var n=r("2908"),i=r.n(n);for(var a in n)"default"!==a&&function(e){r.d(t,e,(function(){return n[e]}))}(a);t["default"]=i.a},e0cb:function(e,t,r){"use strict";var n=r("d403"),i=r.n(n);i.a},e3be:function(e,t,r){"use strict";var n=r("4ea4");r("e25e"),r("ac1f"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r("96cf");var i=n(r("1da1")),a=n(r("5530")),o=n(r("cced")),s=n(r("46ee")),u=n(r("55fc")),d=r("26cb"),c=r("a34d"),l=r("7d2f"),f=(r("13b4"),n(r("e143")),r("c881")),p=r("20ce"),h={components:{userChatBottom:o.default,userChatList:u.default},computed:(0,a.default)((0,a.default)({},(0,d.mapState)(["chatList","userInfo","msgIndex","msgPage"])),(0,d.mapGetters)(["currentChatMsgs"])),data:function(){return{scrollTop:0,triggered:!1,index:-1,style:{contentH:0,itemH:0},list:[],cId:0,socket:null,fid:void 0,isShow:!1,show:!1,need:{need_id:0},order:{order_id:0,state:void 0},timer:null}},onShow:function(){this.isShow=!0},beforeDestroy:function(){this.isShow=!1,this.setIndex(-1),this.setMsgPage(1),this.clear()},onPullDownRefresh:function(){this.initdata()},onLoad:function(e){var t=this;return(0,i.default)(regeneratorRuntime.mark((function r(){var n,i,a,o,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e.index&&(t.setIndex(parseInt(e.index)),t.index=e.index,uni.setNavigationBarTitle({title:t.chatList[t.msgIndex].username})),t.fid=e.fid,n=parseInt(e.fid),i=!0,e.index){r.next=34;break}a=0;case 6:if(!(a<t.chatList.length)){r.next=17;break}if(t.chatList[a].fid!==n){r.next=14;break}return t.index=a,t.setIndex(a),i=!1,uni.setNavigationBarTitle({title:t.chatList[t.msgIndex].username}),t.cId=t.chatList[a].id,r.abrupt("return");case 14:a++,r.next=6;break;case 17:if(!i){r.next=32;break}return t.fid=n,r.next=21,(0,c.createChat)({from_user_id:t.userInfo.id,to_user_id:parseInt(n),chatroom_name:""});case 21:return o=r.sent,r.next=24,(0,c.getChat)(o.id,t.userInfo);case 24:s=r.sent,console.log(s),t.cId=o.id,console.log(t.cId),t.setIndex(0),t.index=0,t.addChatList(s),uni.setNavigationBarTitle({title:s.username});case 32:r.next=36;break;case 34:t.fid=t.chatList[e.index].fid,t.cId=t.chatList[e.index].id;case 36:t.initorder();case 37:case"end":return r.stop()}}),r)})))()},onReady:function(){this.getdata(),this.initdata(),this.pageToBottom(!0),this.initorder(),this.initdata()},watch:{currentChatMsgs:function(e){this.triggered||this.pageToBottom(!0)}},methods:(0,a.default)((0,a.default)({},(0,d.mapMutations)(["setChatMessage","setIsPaper","addChatList","setIndex","setMsgPage","addChatMessage","addNoreadMessage"])),{},{initdata:function(){var e=this;return(0,i.default)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:try{r=uni.getSystemInfoSync(),n=200,e.style.contentH=r.windowHeight-uni.upx2px(n),uni.stopPullDownRefresh()}catch(i){}case 1:case"end":return t.stop()}}),t)})))()},refresh:function(){var e=this;this.timer=setInterval((function(){setTimeout(e.trym,0)}),5e3)},createOrderAndRefresh:function(){if(5==this.userInfo.type){var e={enterprise_id:this.userInfo.id,expert_id:this.fid,need_id:this.need.need_id};(0,c.createOrder)(e)}else if(4==this.userInfo.type){var t={enterprise_id:this.fid,expert_id:this.userInfo.id,need_id:this.need.need_id};(0,c.createOrder)(t)}this.initorder(),this.sendm("我已向您发起订单，需求名为："+this.need.title)},acceptOrderAndRefresh:function(){(0,l.acceptOrder)(this.userInfo.id,this.order.order_id),this.initorder(),this.sendm("我已接受您的订单，需求名为："+this.need.title)},rejectOrderAndRefresh:function(){(0,l.rejectOrder)(this.userInfo.id,this.order.order_id),this.initorder(),this.sendm("我已拒绝您的订单，需求名为："+this.need.title)},accomplishOrderAndRefresh:function(){if(5==this.userInfo.type){var e={enterprise_id:this.userInfo.id,expert_id:this.fid,need_id:this.need.need_id};(0,l.accomplishOrder)(e.enterprise_id,this.order.order_id)}else if(4==this.userInfo.type){var t={enterprise_id:this.fid,expert_id:this.userInfo.id,need_id:this.need.need_id};(0,l.accomplishOrder)(t.enterprise_id,this.order.order_id)}this.initorder(),this.sendm("我们的订单已完成，需求名为："+this.need.title)},initorder:function(){var e=this;return(0,i.default)(regeneratorRuntime.mark((function t(){var r,n,i,a,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(5!=e.userInfo.type){t.next=14;break}return r={enterprise_id:e.userInfo.id,expert_id:e.fid},t.next=4,(0,c.getContact)(r);case 4:if(n=t.sent,!n){t.next=11;break}return t.next=8,(0,p.getNeedDetail)(n.need_id);case 8:e.need=t.sent,t.next=12;break;case 11:e.need={need_id:0};case 12:t.next=26;break;case 14:if(4!=e.userInfo.type){t.next=26;break}return i={enterprise_id:e.fid,expert_id:e.userInfo.id},t.next=18,(0,c.getContact)(i);case 18:if(a=t.sent,!a){t.next=25;break}return t.next=22,(0,p.getNeedDetail)(a.need_id);case 22:e.need=t.sent,t.next=26;break;case 25:e.need={need_id:0};case 26:return o=4==e.userInfo.type?{enterprise_id:e.fid,expert_id:e.userInfo.id,need_id:e.need.need_id}:{enterprise_id:e.userInfo.id,expert_id:e.fid,need_id:e.need.need_id},t.next=29,(0,c.getOrder)(o);case 29:if(s=t.sent,console.log(s),!(s.order_id>0)){t.next=37;break}return t.next=34,(0,f.getOrderDetail)(s.order_id);case 34:e.order=t.sent,t.next=39;break;case 37:e.order.state=void 0,e.order.order_id=0;case 39:case"end":return t.stop()}}),t)})))()},sendm:function(e){var t=this;return(0,i.default)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.submit(e);case 1:case"end":return r.stop()}}),r)})))()},scrollTopHandle:function(){var e=this;this.triggered?setTimeout((function(){e.msgPage>e.currentChatMsgs.length/20&&uni.showToast({title:"没有更多消息了!",icon:"none"}),e.triggered=!1}),200):(this.triggered=!0,this.setMsgPage())},pageToBottom:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=uni.createSelectorQuery().in(this),n=r.selectAll(".chat-item");0!=this.currentChatMsgs.length&&this.$nextTick((function(){n.fields({size:!0},(function(r){if(r){if(t)for(var n=0;n<r.length;n++)e.style.itemH+=r[n].height;else e.style.itemH+=r[r.length-1].height;e.scrollTop=e.style.itemH>e.style.contentH?e.style.itemH:0}})).exec()}))},openmenu:function(){this.show?this.show=!1:this.show=!0},clear:function(){clearInterval(this.timer),this.timer=null},goToUserInfo:function(e){uni.navigateTo({url:"../../pages/user-space/user-space?uid="+this.chatList[this.msgIndex].fid})},goToNeedDetail:function(e){uni.navigateTo({url:"../need-detail/detail?id="+e})},goToOrderDetail:function(e){uni.navigateTo({url:"../order-detail/order-detail?id="+e})},getdata:function(){this.chatList.length},submit:function(e){var t=this;return(0,i.default)(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=(new Date).getTime(),""!=e){r.next=4;break}return uni.showToast({title:"消息不能为空",icon:"none"}),r.abrupt("return");case 4:return r.next=6,(0,c.pushMessage)({cId:t.chatList[t.msgIndex].id,fromId:t.userInfo.id,toId:t.chatList[t.msgIndex].fid,content:e});case 6:if(i=r.sent,!i.code||0==i.code){r.next=10;break}return uni.showToast({title:"消息发送失败!",icon:"none"}),r.abrupt("return");case 10:a={fromId:t.userInfo.id,toId:t.fid,index:t.index,isme:!0,userpic:t.userInfo.userpic,type:"text",message:e,time:s.default.gettime.gettime(n),gstime:n,created_at:n},t.addChatMessage(a),t.pageToBottom(!0);case 13:case"end":return r.stop()}}),r)})))()}})};t.default=h},e6bc:function(e,t,r){var n=r("24fb");t=n(!1),t.push([e.i,'.user-chat-list[data-v-1e3552f9]{padding:%?20?% 0}.user-chat-list>uni-image[data-v-1e3552f9]{width:%?80?%!important;height:%?80?%!important;\n\t/* border-radius: 100%; */flex-shrink:0;margin:0 %?10?%}.user-chat-list-body[data-v-1e3552f9]{position:relative;background:#f4f4f4;padding:%?25?%;margin-left:%?20?%;border-radius:%?20?%;margin-right:%?100?%}.user-chat-list-body[data-v-1e3552f9]:after{position:absolute;left:%?-30?%;right:0;top:%?30?%;content:"";width:0;height:0;border:%?16?% solid #f4f4f4;border-color:transparent #f4f4f4 transparent transparent}.user-chat-me[data-v-1e3552f9]{justify-content:flex-end}.user-chat-me .user-chat-list-body[data-v-1e3552f9]{margin-right:%?20?%;margin-left:%?100?%}.user-chat-me .user-chat-list-body[data-v-1e3552f9]:after{left:auto;right:%?-30?%;border-color:transparent transparent transparent #f4f4f4}.user-chat-list-body>uni-image[data-v-1e3552f9]{max-width:%?150?%;max-height:%?200?%}.user-chat-time[data-v-1e3552f9]{padding:%?50?% 0;color:#a2a2a2;font-size:%?24?%}',""]),e.exports=t},fb60:function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return n}));var n={tuiButton:r("bff5").default,tuiBubblePopup:r("1b6c").default,tuiListCell:r("fe6b").default,tuiIcon:r("3e6d").default},i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-uni-view",[e.need&&e.need.need_id?r("tui-button",{attrs:{size:28,plain:!0},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.openmenu.apply(void 0,arguments)}}},[e._v("需求标题："+e._s(this.need.title))]):e._e(),"5"==e.userInfo.type&&e.need?[r("tui-bubble-popup",{attrs:{show:e.show,mask:!0,position:"absolute",width:"370rpx",translateY:"0rpx",triangleTop:"-50rpx",borderWidth:"0"},on:{close:function(t){arguments[0]=t=e.$handleEvent(t),e.openmenu()}}},[r("tui-list-cell",{attrs:{hover:!0,arrow:!0,backgroundColor:"#dcdcdc"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.goToNeedDetail(e.need.need_id)}}},[r("tui-icon",{attrs:{name:"search"}}),e._v("查看需求")],1)],1),0==e.order.order_id?r("v-uni-view",[r("tui-bubble-popup",{attrs:{show:e.show,mask:!1,position:"absolute",width:"370rpx",translateY:"0rpx",translateX:"380rpx",triangleTop:"-20rpx",borderWidth:"0"},on:{close:function(t){arguments[0]=t=e.$handleEvent(t),e.openmenu()}}},[r("tui-list-cell",{attrs:{hover:!0,arrow:!1,backgroundColor:"#dcdcdc"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.createOrderAndRefresh()}}},[r("tui-icon",{attrs:{name:"order"}}),e._v("发起订单")],1)],1)],1):e._e(),0!=e.order.order_id?r("v-uni-view",[r("tui-bubble-popup",{attrs:{show:e.show,mask:!1,position:"absolute",width:"370rpx",translateY:"0rpx",translateX:"380rpx",triangleTop:"-20rpx",borderWidth:"0"},on:{close:function(t){arguments[0]=t=e.$handleEvent(t),e.openmenu()}}},[r("tui-list-cell",{attrs:{hover:!0,arrow:!0,backgroundColor:"#dcdcdc"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.goToOrderDetail(e.order.order_id)}}},[r("tui-icon",{attrs:{name:"search"}}),e._v("查看订单")],1)],1)],1):e._e(),0!=e.order.order_id&&1==e.order.state?r("tui-bubble-popup",{attrs:{show:e.show,mask:!0,position:"absolute",width:"370rpx",translateY:"120rpx",triangleTop:"-50rpx",borderWidth:"0"},on:{close:function(t){arguments[0]=t=e.$handleEvent(t),e.openmenu()}}},[r("tui-list-cell",{attrs:{hover:!0,arrow:!1,backgroundColor:"#dcdcdc"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.accomplishOrderAndRefresh()}}},[r("tui-icon",{attrs:{name:"check"}}),e._v("完成订单")],1)],1):e._e()]:"4"==e.userInfo.type&&e.need?[r("tui-bubble-popup",{attrs:{show:e.show,mask:!0,position:"absolute",width:"370rpx",translateY:"0rpx",triangleTop:"-50rpx",borderWidth:"0"},on:{close:function(t){arguments[0]=t=e.$handleEvent(t),e.openmenu()}}},[r("tui-list-cell",{attrs:{hover:!0,arrow:!0,backgroundColor:"#dcdcdc"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.goToNeedDetail(e.need.need_id)}}},[r("tui-icon",{attrs:{name:"search"}}),e._v("查看需求")],1)],1),0!=e.order.order_id?[r("tui-bubble-popup",{attrs:{show:e.show,mask:!1,position:"absolute",width:"370rpx",translateY:"0rpx",translateX:"380rpx",triangleTop:"-20rpx",borderWidth:"0"},on:{close:function(t){arguments[0]=t=e.$handleEvent(t),e.openmenu()}}},[r("tui-list-cell",{attrs:{hover:!0,arrow:!0,backgroundColor:"#dcdcdc"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.goToOrderDetail(e.order.order_id)}}},[r("tui-icon",{attrs:{name:"search"}}),e._v("查看订单")],1)],1),0==e.order.state?r("v-uni-view",[r("tui-bubble-popup",{attrs:{show:e.show,mask:!0,position:"absolute",width:"370rpx",translateY:"120rpx",triangleTop:"-50rpx",borderWidth:"0"},on:{close:function(t){arguments[0]=t=e.$handleEvent(t),e.openmenu()}}},[r("tui-list-cell",{attrs:{hover:!0,arrow:!1,backgroundColor:"#dcdcdc"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.acceptOrderAndRefresh()}}},[r("tui-icon",{attrs:{name:"check"}}),e._v("接受订单")],1)],1),r("tui-bubble-popup",{attrs:{show:e.show,mask:!1,position:"absolute",width:"370rpx",translateY:"120rpx",translateX:"380rpx",triangleTop:"-20rpx",borderWidth:"0"},on:{close:function(t){arguments[0]=t=e.$handleEvent(t),e.openmenu()}}},[r("tui-list-cell",{attrs:{hover:!0,arrow:!1,backgroundColor:"#dcdcdc"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.rejectOrderAndRefresh()}}},[r("tui-icon",{attrs:{name:"shut"}}),e._v("拒绝订单")],1)],1)],1):e._e()]:e._e()]:e._e(),r("v-uni-scroll-view",{style:{height:e.style.contentH+"px"},attrs:{id:"scrollview","scroll-y":!0,"scroll-top":e.scrollTop,"scroll-with-animation":!0,"refresher-enabled":!0,"refresher-triggered":e.triggered},on:{refresherrefresh:function(t){arguments[0]=t=e.$handleEvent(t),e.scrollTopHandle.apply(void 0,arguments)}}},[e._l(e.currentChatMsgs,(function(t,n){return[r("v-uni-view",{key:n+"_0",staticClass:"chat-item"},[r("user-chat-list",{attrs:{item:t,index:n},on:{goToUserInfo:function(t){arguments[0]=t=e.$handleEvent(t),e.goToUserInfo.apply(void 0,arguments)}}})],1)]}))],2),r("user-chat-bottom",{on:{submit:function(t){arguments[0]=t=e.$handleEvent(t),e.submit.apply(void 0,arguments)}}})],2)},a=[]}}]);